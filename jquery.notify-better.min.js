!function($){function abbrNum(t,e){e=Math.pow(10,e);for(var i=["k","m","b","t"],a=i.length-1;a>=0;a--){var n=Math.pow(10,3*(a+1));if(t>=n){t=Math.round(t*e/n)/e,1e3==t&&a<i.length-1&&(t=1,a++),t+=i[a];break}}return t}var defaults={url:!1,interval:5e3,overrideAjax:!1,updateTitle:!1,updateFavicon:{id:"favicon",textColor:"#fff",backgroundColor:"#e74c3c",location:"full",shape:"square"},done:function(){}};$.fn.notify_better=function(options){var settings=$.extend({},defaults,options),el=$(this);titleclear=function(){var t,e;e=/\(([0-9]+)\)/,t=document.title,null!==t&&(document.title=document.title.replace(e,""))},$.fn.clear=function(){titleclear(),init=$("#"+settings.updateFavicon.id).attr($("#"+settings.updateFavicon.id).data("initial")?"data-initial":"href"),$("#"+settings.updateFavicon.id).attr("href",init),$("#new-favicon").remove(),$("<link id='new-favicon' type='image/x-icon' href='"+init+"' rel='shortcut icon'>").appendTo("head"),$(this).hide().html("")},changeFavicon=function(t){if(t>0){{var e,i=document.createElement("canvas"),a=document.createElement("img");document.getElementById(settings.updateFavicon.id).cloneNode(!0)}link_href=document.getElementById(settings.updateFavicon.id).href,t>99&&(t=99),i.getContext&&(i.height=i.width=16,e=i.getContext("2d"),a.onload=function(){switch(e.drawImage(this,0,0),settings.updateFavicon.location){case"full":if("square"==settings.updateFavicon.shape)e.fillStyle=settings.updateFavicon.backgroundColor,e.fillRect(0,0,16,16);else{var a=i.width/2,n=i.height/2,l=8;e.beginPath(),e.arc(a,n,l,0,2*Math.PI,!1),e.fillStyle=settings.updateFavicon.backgroundColor,e.fill()}e.textAlign="center",e.font='bold 10px "helvetica", sans-serif',e.fillStyle=settings.updateFavicon.textColor,e.fillText(t,8,12);break;case"se":if("square"==settings.updateFavicon.shape)e.fillStyle=settings.updateFavicon.backgroundColor,e.fillRect(5,5,16,16);else{var l=6;e.beginPath(),e.arc(12,12,l,0,2*Math.PI,!1),e.fillStyle=settings.updateFavicon.backgroundColor,e.fill()}e.font='bold 8px "helvetica", sans-serif',e.textAlign="right",e.fillStyle=settings.updateFavicon.textColor,e.fillText(t,15,15);break;case"ne":if("square"==settings.updateFavicon.shape)e.fillStyle=settings.updateFavicon.backgroundColor,e.fillRect(5,0,11,10);else{var l=6;e.beginPath(),e.arc(12,3,l,0,2*Math.PI,!1),e.fillStyle=settings.updateFavicon.backgroundColor,e.fill()}e.font='bold 8px "helvetica", sans-serif',e.textAlign="right",e.fillStyle=settings.updateFavicon.textColor,e.fillText(t,15,7);break;case"nw":if("square"==settings.updateFavicon.shape)e.fillStyle=settings.updateFavicon.backgroundColor,e.fillRect(0,0,11,10);else{var l=6;e.beginPath(),e.arc(5,3,l,0,2*Math.PI,!1),e.fillStyle=settings.updateFavicon.backgroundColor,e.fill()}e.font='bold 8px "helvetica", sans-serif',e.textAlign="left",e.fillStyle=settings.updateFavicon.textColor,e.fillText(t,1,7);break;case"sw":if("square"==settings.updateFavicon.shape)e.fillStyle=settings.updateFavicon.backgroundColor,e.fillRect(0,5,11,11);else{var l=6;e.beginPath(),e.arc(5,12,l,0,2*Math.PI,!1),e.fillStyle=settings.updateFavicon.backgroundColor,e.fill()}e.font='bold 8px "helvetica", sans-serif',e.textAlign="left",e.fillStyle=settings.updateFavicon.textColor,e.fillText(t,1,14)}var o=$("#"+settings.updateFavicon.id).attr("href");$("#"+settings.updateFavicon.id).data("initial")?$("#"+settings.updateFavicon.id).attr("href",i.toDataURL("image/png")):$("#"+settings.updateFavicon.id).attr("data-initial",o).attr("href",i.toDataURL("image/png")),$("#new-favicon").remove(),$("<link id='new-favicon' type='image/x-icon' href='"+i.toDataURL("image/png")+"' rel='shortcut icon'>").appendTo("head")},a.src=link_href)}},getNotification=function(){0!=settings.overrideAjax?settings.overrideAjax():$.ajax({url:settings.url}).done(function(data,textStatus,jqXHR){titleclear(),notif=eval(data),el.hide().html(notif).fadeIn("slow"),1==settings.updateTitle&&(document.title="("+notif+") "+document.title),0!=settings.updateFavicon&&changeFavicon(notif),settings.done()})},0==settings.interval||0==settings.interval?getNotification():setInterval(function(){getNotification()},settings.interval)}}(window.jQuery);